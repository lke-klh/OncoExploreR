expected,
tolerance = mass_balance_tol))) {
mass_balance_ok <- FALSE
break
}
}
mass_balance_max_err <- max(mb_errs)
# Parameter checks
rel_diff_fp <- abs(fibrosis_progression_yearly - target_fp_yearly) / target_fp_yearly
fp_ok <- all(rel_diff_fp <= rel_tol_rates)
mort_F4_ok <- abs((19/3505) - liver_mortality_rate_F4) / (19/3505) < rel_tol_rates
mort_DC_ok <- abs((87/412)  - liver_mortality_rate_DC) / (87/412)  < rel_tol_rates
data.table(
init_ok = init_ok,
sum_to_one = sum_to_one,
F0_decreasing = F0_decreasing,
Dead_HCV_nd = dh_nd,
Dead_other_nd = do_nd,
all_ok = all_ok,
all_max_abs = all_max_abs,
mass_balance_ok = mass_balance_ok,
mass_balance_max_err = mass_balance_max_err,
fp_ok = fp_ok,
fp_rel_max = max(rel_diff_fp),
mort_F4_ok = mort_F4_ok,
mort_DC_ok = mort_DC_ok
)
}
# parallel run model
tic("Model Starts")
out <- foreach(
j = 1:trials,
.combine = function(x, y) rbindlist(list(x, y), fill = TRUE),
.packages = c("tidyverse", "data.table", "readxl")
) %dopar% {
trace <- run_markov()
diag <- check_run(trace)
diag[, id := j]
diag
}
toc(log = TRUE)
# Save output
saveRDS(out, "out_markov_checks.rds")
out <- readRDS("out_markov_checks.rds")
# Summary
summary_flags <- out[, .(
pass_init            = mean(init_ok),
pass_sum_to_one      = mean(sum_to_one),
pass_F0_decreasing   = mean(F0_decreasing),
pass_dead_HCV_nd     = mean(Dead_HCV_nd),
pass_dead_other_nd   = mean(Dead_other_nd),
pass_all             = mean(all_ok, na.rm = TRUE),
max_all_abs          = max(all_max_abs, na.rm = TRUE),
pass_mass_balance    = mean(mass_balance_ok),
max_mass_balance_err = max(mass_balance_max_err),
pass_fp              = mean(fp_ok),
max_fp_rel_diff      = max(fp_rel_max),
pass_mort_F4         = mean(mort_F4_ok),
pass_mort_DC         = mean(mort_DC_ok)
)]
print(summary_flags)
# Targets vs observed tables
fp_table <- data.frame(
parameter = c("F0→F1", "F1→F2", "F2→F3", "F3→F4", "F4→DC"),
observed  = fibrosis_progression_yearly,
target    = target_fp_yearly
) %>%
mutate(
relative_difference = abs(observed - target) / target,
meets_threshold = relative_difference <= rel_tol_rates
)
mort_table <- data.frame(
parameter = c("F4 liver mortality", "DC liver mortality"),
observed  = c(liver_mortality_rate_F4, liver_mortality_rate_DC),
target    = c(19/3505, 87/412)
) %>%
mutate(
relative_difference = abs(observed - target) / target,
meets_threshold = relative_difference <= rel_tol_rates
)
# cat("\nMarkov Checks Report\n")
# print(summary_flags)
# cat("\nFibrosis progression (yearly)\n")
# print(fp_table)
# cat("\nMortality parameters\n")
# print(mort_table)
# Success message
print("Model Success!")
log_data <- tic.log(format = FALSE)
log_data[[length(log_data)]]$callback_msg
df <- read_delim("Agent Model Summary.csv")
head(df, 5)
tumor <- read_delim("data/tumor.csv")
library(tidyverse)
library(ggplot2)
library(gt)
library(gtsummary)
library(patchwork)
library(MASS)
library(car)
library(VGAM)
library(caret)
tumor <- read_delim("data/tumor.csv")
tumor$treatment <- relevel(factor(tumor$treatment), ref = "sequential")
tumor$sex <- relevel(factor(tumor$sex), ref = "female")
tumor$response <- relevel(factor(tumor$response), ref = "progressive")
m_full <- glm(frequency ~ treatment * sex * response,
family = poisson(link = "log"),
data = tumor)
m_noint <- glm(frequency ~ treatment + sex + response,
family = poisson(link = "log"),
data = tumor)
m_step <- stepAIC(
m_full,
direction = "backward",
trace = FALSE
)
summary(m_step)
anova(m_full, m_noint, m_step)
AIC(m_full, m_noint, m_step)
m1_unadj <- vglm(response ~ treatment + response,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
tumor <- read_delim("data/tumor.csv")
tumor$treatment <- relevel(factor(tumor$treatment), ref = "sequential")
tumor$sex <- relevel(factor(tumor$sex), ref = "female")
tumor$response <- relevel(factor(tumor$response), ref = "progressive")
m_full <- glm(frequency ~ treatment * sex * response,
family = poisson(link = "log"),
data = tumor)
m_noint <- glm(frequency ~ treatment + sex + response,
family = poisson(link = "log"),
data = tumor)
m_step <- stepAIC(
m_full,
direction = "backward",
trace = FALSE
)
summary(m_step)
anova(m_full, m_noint, m_step)
AIC(m_full, m_noint, m_step)
m1_unadj <- vglm(response ~ treatment + response,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
m1_unadj <- vglm(response ~ treatment + sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
m2_unadj <- vglm(response ~ treatment * sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
anova(m1_unadj, m2_unadj)
m1_unadj <- vglm(response ~ treatment + sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
m2_unadj <- vglm(response ~ treatment * sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
lrtest(m1_unadj, m2_unadj)
AIC(m1_unadj)
AIC(m2_unadj)
m1_unadj <- vglm(response ~ treatment + sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
m2_unadj <- vglm(response ~ treatment * sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
summary(m1_unadj)
lrtest(m1_unadj, m2_unadj)
AIC(m1_unadj)
AIC(m2_unadj)
m1 <- vglm(response ~ treatment + sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
m2 <- vglm(response ~ treatment * sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
lrtest(m1, m2)
AIC(m1)
AIC(m2)
m1 <- vglm(response ~ treatment + sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
m2 <- vglm(response ~ treatment * sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
lrtest(m1, m2)
AIC(m1)
AIC(m2)
m1 <- vglm(response ~ treatment + sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
m2 <- vglm(response ~ treatment * sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
lrtest(m1, m2)
AIC(m1)
AIC(m2)
AIC(m1)
AIC(m2)
summary(m2)
AIC(m1)
AIC(m2)
summary(m1)
formula(m1)
summary(m1)
pred_probs <- predict(m1, type = "response")
pred_class <- apply(pred_probs, 1, which.max)
conf_matrix <- confusionMatrix(factor(tumor$response, levels = 1:3),
factor(pred_class, levels = 1:3))
conf_matrix
unagg_data <- tumor[rep(1:nrow(data_agg), data_agg$frequency), ]
unagg_data <- tumor[rep(1:nrow(tumor), tumor$frequency), ]
pred_probs <- predict(m1, unagg_data, type = "probs")
unagg_data <- tumor[rep(1:nrow(tumor), tumor$frequency), ]
pred_probs <- predict(m1, unagg_data, type = "response")
pred_class_index <- apply(pred_probs, 1, which.max)
pred_class <- factor(pred_class_index,
levels = 1:nlevels(unagg_data$response),
labels = levels(unagg_data$response))
conf_matrix <- confusionMatrix(data = pred_class,
reference = unagg_data$response)
conf_matrix
tumor <- read_delim("data/tumor.csv")
response_order <- c("progressive", "no change", "partial remission", "complete remission")
tumor$response <- factor(tumor$response, levels = response_order, ordered = TRUE)
tumor$treatment <- factor(tumor$treatment, levels = c("alternating", "sequential"))
tumor$sex <- factor(tumor$sex, levels = c("male", "female"))
m1 <- vglm(response ~ treatment + sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
m2 <- vglm(response ~ treatment * sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
lrtest(m1, m2)
summary(m2)
AIC(m1)
AIC(m2)
summary(m1)
unagg_data <- tumor[rep(1:nrow(tumor), tumor$frequency), ]
pred_probs <- predict(m1, unagg_data, type = "response")
pred_class_index <- apply(pred_probs, 1, which.max)
pred_class <- factor(pred_class_index,
levels = 1:nlevels(unagg_data$response),
labels = levels(unagg_data$response))
conf_matrix <- confusionMatrix(data = pred_class,
reference = unagg_data$response)
conf_matrix
tumor <- read_delim("data/tumor.csv")
response_order <- c("progressive", "no change", "partial remission", "complete remission")
tumor$response <- relevel(factor(tumor$treatment), ref = "sequential")
tumor$treatment <- factor(tumor$treatment, levels = c("alternating", "sequential"))
tumor$sex <- relevel(factor(tumor$sex), ref = "female")
m1 <- vglm(response ~ treatment + sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
m2 <- vglm(response ~ treatment * sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
lrtest(m1, m2)
summary(m2)
AIC(m1)
AIC(m2)
tumor <- read_delim("data/tumor.csv")
response_order <- c("progressive", "no change", "partial remission", "complete remission")
tumor$response <- factor(tumor$response, levels = response_order, ordered = TRUE)
tumor$treatment <- relevel(factor(tumor$treatment), ref = "sequential")
tumor$sex <- relevel(factor(tumor$sex), ref = "female")
m1 <- vglm(response ~ treatment + sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
m2 <- vglm(response ~ treatment * sex,
family = cumulative(parallel = TRUE),
data = tumor, weights = frequency)
lrtest(m1, m2)
summary(m2)
AIC(m1)
AIC(m2)
summary(m1)
unagg_data <- tumor[rep(1:nrow(tumor), tumor$frequency), ]
pred_probs <- predict(m1, unagg_data, type = "response")
pred_class_index <- apply(pred_probs, 1, which.max)
pred_class <- factor(pred_class_index,
levels = 1:nlevels(unagg_data$response),
labels = levels(unagg_data$response))
conf_matrix <- confusionMatrix(data = pred_class,
reference = unagg_data$response)
conf_matrix
.Machine$double.eps*10
shiny::runApp('Documents/PHP2560/website/2560FinalProj')
runApp('Documents/PHP2560/website/2560FinalProj')
runApp('Documents/PHP2560/website/2560FinalProj')
runApp('Documents/PHP2560/website/PanCancerSimulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp()
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
exp(5)
exp(-5)
exp(-4)
exp(4)
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
installed.packages(biomaRt)
install.packages(biomaRt)
install.packages(biomaRt)
install.packages("biomaRt")
install.packages("BiocManager")
BiocManager::install("biomaRt")
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
shiny::runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
runApp('Documents/PHP2560/website/pan-cancer-simulator')
shiny::runApp('Documents/PHP2560/website/pan-cancer-simulator')
setwd("Documents/PHP2560/website/pan-cancer-simulator/")
runApp()
runApp()
install.packages("pheatmap")
runApp()
runApp()
runApp()
runApp()
runApp()
install.packages("plotly")
install.packages("plotly")
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
rsconnect::showLogs(appName = "pan-cancer-simulator", streaming = TRUE)
rsconnect::deployApp(appName = "pan-cancer-simulator")
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
y <- c(1, 0, 0, 0, 1, 0, 1, 0, 1, 1)
cat("The MLE of p is:", p_hat, "\n")
y <- c(1, 0, 0, 0, 1, 0, 1, 0, 1, 1)
n <- length(y)
sum_y <- sum(y)
p_hat <- mean(y)
log_likelihood <- function(p, n, sum_y) {
if (p <= 0 || p >= 1) return(-Inf)
return(sum_y * log(p) + (n - sum_y) * log(1 - p))
}
p_seq <- seq(0.01, 0.99, length.out = 500)
ll_values <- sapply(p_seq, log_likelihood, n = n, sum_y = sum_y)
plot(p_seq, ll_values, type = "l", col = "blue", lwd = 2,
main = expression(paste("Log-likelihood ", ell(p))),
xlab = "p", ylab = "Log-Likelihood",
ylim = c(-100, 0))
abline(v = p_hat, col = "red", lwd = 2, lty = 2)
mle_info <- n / (p_hat * (1 - p_hat))
cat("The MLE of p is:", p_hat, "\n")
cat("The MLE of the information I(p) is:", mle_info, "\n")
y <- c(1,0,0,0,1,0,1,0,1,1)
n <- length(y)
k <- sum(y)
loglik <- function(p) {
k * log(p) + (n - k) * log(1 - p)
}
pvals <- seq(0.001, 0.999, length.out = 1000)
llvals <- sapply(pvals, loglik)
plot(pvals, llvals, type = "l",
xlab = "p", ylab = "log-likelihood",
ylim = c(-100, 0))
abline(v = k/n, col = "red", lwd = 2)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
